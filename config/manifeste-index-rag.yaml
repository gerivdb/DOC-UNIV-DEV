# Configuration complète du RAG Index pour DOC-UNIV-DEV
# Manifeste des paramètres d'indexation et de recherche

# ============================================================================
# CONFIGURATION DES EMBEDDINGS
# ============================================================================
embedding:
  # Modèle d'embedding principal
  model:
    provider: "openai"  # openai, huggingface, sentence-transformers, cohere
    name: "text-embedding-3-large"
    dimensions: 3072
    max_tokens: 8191
    
  # Modèle d'embedding alternatif (fallback)
  fallback_model:
    provider: "openai"
    name: "text-embedding-3-small"
    dimensions: 1536
    max_tokens: 8191
    
  # Options d'embedding multilingue
  multilingual:
    enabled: true
    languages:
      - "fr"  # Français (prioritaire)
      - "en"  # Anglais
      - "es"  # Espagnol
      - "de"  # Allemand
    model: "multilingual-e5-large"
    
  # Normalisation des embeddings
  normalization:
    enabled: true
    method: "l2"  # l2, l1, max
    
# ============================================================================
# MÉTRIQUES DE DISTANCE
# ============================================================================
distance_metrics:
  # Métrique principale
  primary:
    type: "cosine"  # cosine, euclidean, dot_product, manhattan
    threshold: 0.7  # Seuil de similarité minimum (0-1)
    
  # Métriques secondaires pour validation croisée
  secondary:
    - type: "euclidean"
      weight: 0.3
    - type: "dot_product"
      weight: 0.2
      
  # Combinaison hybride des métriques
  hybrid:
    enabled: true
    combination_method: "weighted_average"  # weighted_average, max, min
    
# ============================================================================
# PARAMÈTRES DE CHUNKING
# ============================================================================
chunking:
  # Stratégie de découpage
  strategy: "semantic"  # semantic, fixed, recursive, document_structure
  
  # Paramètres de taille
  size:
    chunk_size: 1000  # Nombre de tokens par chunk
    chunk_overlap: 200  # Overlap entre chunks
    min_chunk_size: 100  # Taille minimale d'un chunk
    max_chunk_size: 2000  # Taille maximale d'un chunk
    
  # Séparateurs pour le chunking récursif
  separators:
    - "\n\n\n"  # Triple saut de ligne (sections)
    - "\n\n"    # Double saut de ligne (paragraphes)
    - "\n"      # Simple saut de ligne
    - ". "      # Fin de phrase
    - ", "      # Virgule
    - " "       # Espace
    
  # Préservation de la structure
  structure_preservation:
    enabled: true
    keep_headers: true
    keep_lists: true
    keep_code_blocks: true
    keep_tables: true
    
  # Chunking sémantique avancé
  semantic:
    enabled: true
    similarity_threshold: 0.8
    min_sentences_per_chunk: 2
    max_sentences_per_chunk: 10
    
  # Métadonnées de chunk
  metadata:
    include_position: true
    include_source: true
    include_timestamp: true
    include_hash: true
    include_parent_doc: true
    
# ============================================================================
# PARAMÈTRES TOP_K
# ============================================================================
top_k:
  # Valeurs par défaut
  default: 5
  min: 1
  max: 50
  
  # Top_k par type de requête
  by_query_type:
    factual: 3        # Questions factuelles
    exploratory: 10   # Recherche exploratoire
    comparative: 7    # Comparaisons
    code_search: 5    # Recherche de code
    definition: 2     # Définitions
    
  # Top_k adaptatif
  adaptive:
    enabled: true
    min_similarity: 0.7  # Réduire top_k si similarité élevée
    max_similarity: 0.5  # Augmenter top_k si similarité faible
    
  # Reranking des résultats
  reranking:
    enabled: true
    model: "cross-encoder/ms-marco-MiniLM-L-6-v2"
    top_n_after_rerank: 5
    
# ============================================================================
# FILTRES DE RECHERCHE
# ============================================================================
filters:
  # Filtres par métadonnées
  metadata:
    # Filtrage par source
    source:
      enabled: true
      allowed_types:
        - "documentation"
        - "code"
        - "research"
        - "configuration"
        - "notes"
      exclude_types:
        - "temp"
        - "backup"
        - "draft"
        
    # Filtrage temporel
    temporal:
      enabled: true
      date_field: "modified_date"
      recency_boost: 0.2  # Boost pour documents récents
      max_age_days: 365   # Âge maximum des documents
      
    # Filtrage par langue
    language:
      enabled: true
      preferred: ["fr", "en"]
      fallback_enabled: true
      
    # Filtrage par catégorie
    category:
      enabled: true
      hierarchy:
        - "architecture"
        - "implementation"
        - "testing"
        - "deployment"
        - "documentation"
        
  # Filtres de qualité
  quality:
    enabled: true
    min_content_length: 50      # Longueur minimale du contenu
    min_information_density: 0.3 # Densité d'information minimale
    exclude_low_quality: true
    
  # Filtres de pertinence
  relevance:
    enabled: true
    keyword_boost: 0.3           # Boost pour correspondance exacte
    phrase_match_boost: 0.5      # Boost pour phrases exactes
    fuzzy_matching: true
    fuzzy_threshold: 0.8
    
  # Filtres de contexte
  context:
    enabled: true
    include_parent: true         # Inclure le contexte parent
    include_children: true       # Inclure le contexte enfant
    context_window: 2            # Nombre de chunks adjacents
    
# ============================================================================
# INDEX VECTORIEL
# ============================================================================
vector_index:
  # Type d'index
  type: "hnsw"  # hnsw, ivf, flat, annoy
  
  # Paramètres HNSW (Hierarchical Navigable Small World)
  hnsw:
    m: 16                # Nombre de connexions par nœud
    ef_construction: 200 # Taille du dynamic candidate list
    ef_search: 100       # Taille du search candidate list
    
  # Paramètres IVF (Inverted File Index)
  ivf:
    nlist: 100          # Nombre de clusters
    nprobe: 10          # Nombre de clusters à explorer
    
  # Performance
  performance:
    parallel_indexing: true
    batch_size: 100
    cache_size: 1000
    
# ============================================================================
# RECHERCHE HYBRIDE
# ============================================================================
hybrid_search:
  enabled: true
  
  # Combinaison vectorielle et keyword
  combination:
    vector_weight: 0.7
    keyword_weight: 0.3
    
  # BM25 pour recherche keyword
  bm25:
    k1: 1.5
    b: 0.75
    
  # Fusion des résultats
  fusion:
    method: "rrf"  # rrf (reciprocal rank fusion), linear, weighted
    rrf_k: 60
    
# ============================================================================
# CACHE ET OPTIMISATION
# ============================================================================
cache:
  # Cache des embeddings
  embeddings:
    enabled: true
    max_size: 10000
    ttl: 86400  # 24 heures
    
  # Cache des résultats de recherche
  search_results:
    enabled: true
    max_size: 1000
    ttl: 3600   # 1 heure
    
  # Cache des reranking
  reranking:
    enabled: true
    max_size: 500
    ttl: 1800   # 30 minutes
    
# ============================================================================
# MONITORING ET MÉTRIQUES
# ============================================================================
monitoring:
  enabled: true
  
  # Métriques à tracker
  metrics:
    - "search_latency"
    - "embedding_latency"
    - "reranking_latency"
    - "cache_hit_rate"
    - "average_similarity"
    - "results_distribution"
    
  # Logging
  logging:
    level: "info"  # debug, info, warning, error
    include_queries: true
    include_results: false
    log_slow_queries: true
    slow_query_threshold_ms: 1000
    
# ============================================================================
# CONFIGURATION EXPÉRIMENTALE
# ============================================================================
experimental:
  # Dense-sparse hybrid
  dense_sparse_hybrid:
    enabled: false
    sparse_model: "splade"
    
  # Multi-vector retrieval
  multi_vector:
    enabled: false
    num_vectors_per_doc: 3
    
  # Query expansion
  query_expansion:
    enabled: true
    method: "llm"  # llm, wordnet, synonyms
    max_expansions: 3
    
  # Contextual compression
  contextual_compression:
    enabled: false
    compression_ratio: 0.5
    
# ============================================================================
# MÉTADONNÉES DU MANIFESTE
# ============================================================================
metadata:
  version: "1.0.0"
  created_at: "2025-11-03"
  updated_at: "2025-11-03"
  author: "DOC-UNIV-DEV Team"
  description: "Configuration complète du système RAG pour l'indexation et la recherche intelligente"
  tags:
    - "rag"
    - "indexation"
    - "embeddings"
    - "recherche"
    - "vectoriel"
